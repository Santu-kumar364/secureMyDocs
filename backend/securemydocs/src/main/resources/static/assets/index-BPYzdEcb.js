import{a,u as Fe,g as Se,h as Z,j as e,L as pe,l as br,m as Ze,n as K,N as qe,o as fr,p as jr,q as yr,P as Sr,B as vr}from"./vendor-react-DAr7Wq2V.js";import{G as fe,H as wr,I as kr}from"./vendor-BKdmUYVI.js";import{B as t,Z as je,P as X,L as Cr,T as l,F as ne,A as D,a as B,I as ge,b as N,V as kt,c as Xe,d as O,C as Q,D as ke,e as Er,E as Ct,f as Re,g as me,u as et,h as Et,i as re,R as Pr,j as Tr,G as U,k as de,l as ce,m as ct,S as Pt,M as tt,n as ee,o as Tt,p as Rt,q as At,r as It,s as Ae,t as $,v as Ge,w as Ot,x as Ie,y as Rr,z as rt,H as st,J as nt,K as ot,N as at,O as Ue,Q as Qe,U as Oe,W as Ar,X as ze,Y as Ye,_ as Ft,$ as Ir,a0 as Or,a1 as Lt,a2 as $e,a3 as ut,a4 as xt,a5 as ht,a6 as Fr,a7 as Lr,a8 as _r,a9 as pt,aa as Nr,ab as Je,ac as se,ad as le,ae as Dr,af as zr,ag as gt,ah as Ne,ai as be,aj as Ur,ak as Wr,al as Mr,am as Gr,an as $r,ao as Br,ap as Vr,aq as Hr,ar as mt,as as Be,at as bt,au as ft,av as jt,aw as yt,ax as Ve,ay as St,az as De,aA as He,aB as qr,aC as Qr,aD as Yr}from"./vendor-mui-DmQffwhm.js";import"./vendor-ui-D66Dn50Q.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))b(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&b(g)}).observe(document,{childList:!0,subtree:!0});function r(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function b(d){if(d.ep)return;d.ep=!0;const p=r(d);fetch(d.href,p)}})();const ye="http://localhost:8080/",Jr=localStorage.getItem("jwt"),M=fe.create({baseURL:ye,headers:{Authorization:`Bearer ${Jr}`,"Content-Type":"application/json"}}),_t="LOGIN_REQUEST",Nt="LOGIN_SUCCESS",Dt="LOGIN_FAILURE",zt="REGISTER_REQUEST",Ut="REGISTER_SUCCESS",Wt="REGISTER_FAILURE",Mt="GET_PROFILE_REQUEST",Gt="GET_PROFILE_SUCCESS",$t="GET_PROFILE_FAILURE",Kr="LOGOUT",Zr=o=>async n=>{try{n({type:_t});const{data:r}=await fe.post(`${ye}auth/signin`,o);(r.token||r.jwt)&&localStorage.setItem("jwt",r.token||r.jwt),console.log("Login success:",r),n({type:Nt,payload:r.token||r.jwt})}catch(r){console.error("Login error:",r.response?r.response.data:r.message),n({type:Dt,payload:r.response?r.response.data.message:r.message})}},Xr=o=>async n=>{try{n({type:zt});const{data:r}=await fe.post(`${ye}auth/signup`,o);r.jwt&&localStorage.setItem("jwt",r.jwt),console.log("Register success:",r),n({type:Ut,payload:r.jwt})}catch(r){console.error("Register error:",r.response?.data||r.message),n({type:Wt,payload:r.response?.data||r.message})}},es=o=>async n=>{try{n({type:Mt});const{data:r}=await fe.get(`${ye}api/users/profile`,{headers:{Authorization:`Bearer ${o}`}});console.log("profile_ _ _ _ ",r),n({type:Gt,payload:r})}catch(r){console.log("_ _ _ _ _ _",r),n({type:$t,payload:r})}},ts=()=>o=>{localStorage.removeItem("jwt"),o({type:"LOGOUT",payload:"User logged out"})};function rs(){const[o,n]=a.useState(""),[r,b]=a.useState(""),[d,p]=a.useState(!1),[g,m]=a.useState(!1),[h,k]=a.useState(""),A=Fe(),T=Se(),{auth:E}=Z(v=>v.auth);a.useEffect(()=>{E?.user&&A("/dashboard")},[E,A]);const R=async v=>{v.preventDefault(),m(!0),k("");try{await T(Zr({email:o,password:r}))}catch{k("Invalid email or password. Please try again.")}finally{m(!1)}};return e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite","@keyframes gradientShift":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}}},children:e.jsx(je,{in:!0,timeout:800,children:e.jsxs(t,{sx:{width:"100%",maxWidth:440},children:[e.jsxs(X,{elevation:24,sx:{padding:4,borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)",overflow:"hidden",position:"relative","&::before":{content:'""',position:"absolute",top:-7,left:0,right:0,height:6,background:"linear-gradient(90deg, #667eea, #764ba2)"}},children:[e.jsx(t,{sx:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsx(t,{sx:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsxs(t,{position:"relative",zIndex:1,children:[e.jsxs(t,{textAlign:"center",mb:3,children:[e.jsx(t,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:70,height:70,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",mb:2},children:e.jsx(Cr,{sx:{fontSize:32}})}),e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Welcome Back"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Sign in to your SecureMyDocs account"})]}),e.jsx(ne,{in:!!h,timeout:500,children:e.jsx(t,{children:h&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:h})})}),e.jsx(ne,{in:!!E?.error,timeout:500,children:e.jsx(t,{children:E?.error&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:E.error.message||"Authentication failed"})})}),e.jsxs(t,{component:"form",onSubmit:R,sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(B,{fullWidth:!0,label:"Email Address",variant:"outlined",type:"email",value:o,onChange:v=>n(v.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(B,{fullWidth:!0,label:"Password",variant:"outlined",type:d?"text":"password",value:r,onChange:v=>b(v.target.value),required:!0,InputProps:{endAdornment:e.jsx(ge,{position:"end",children:e.jsx(N,{onClick:()=>p(!d),edge:"end",children:d?e.jsx(kt,{}):e.jsx(Xe,{})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(O,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",size:"large",disabled:g||!o||!r,sx:{py:1.8,borderRadius:2,textTransform:"none",fontSize:"1.05rem",fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 6px 16px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 22px rgba(102, 126, 234, 0.5)",transform:"translateY(-2px)",background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"},"&:active":{transform:"translateY(0)"}},children:g?e.jsx(Q,{size:24,sx:{color:"white"}}):"Log In"})]}),e.jsx(t,{sx:{textAlign:"center",my:3},children:e.jsx(ke,{sx:{mb:3},children:e.jsx(l,{variant:"body2",color:"text.secondary",children:"OR"})})}),e.jsx(t,{sx:{textAlign:"center",mb:2},children:e.jsx(O,{component:pe,to:"/forgot-password",variant:"text",color:"primary",size:"small",sx:{textTransform:"none",fontWeight:500},children:"Forgot your password?"})})]})]}),e.jsx(X,{elevation:8,sx:{mt:2,p:3,borderRadius:3,background:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",textAlign:"center"},children:e.jsxs(l,{variant:"body2",children:["Don't have an account?"," ",e.jsx(O,{component:pe,to:"/register",variant:"text",color:"primary",sx:{textTransform:"none",fontWeight:600,fontSize:"inherit",p:0,minWidth:"auto"},children:"Sign up"})]})})]})})})}function ss(){const[o,n]=a.useState(""),[r,b]=a.useState(""),[d,p]=a.useState(""),[g,m]=a.useState(""),[h,k]=a.useState(!1),[A,T]=a.useState(!1),[E,R]=a.useState(""),v=Fe(),f=Se(),{auth:S}=Z(C=>C.auth);a.useEffect(()=>{S?.user&&v("/dashboard")},[S,v]);const F=async C=>{C.preventDefault(),T(!0),R("");try{await f(Xr({firstName:r,lastName:d,email:o,password:g}))}catch{R("Registration failed. Please try again.")}finally{T(!1)}};return e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite","@keyframes gradientShift":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}}},children:e.jsx(je,{in:!0,timeout:800,children:e.jsxs(t,{sx:{width:"100%",maxWidth:480},children:[e.jsxs(X,{elevation:24,sx:{padding:4,borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)",overflow:"hidden",position:"relative","&::before":{content:'""',position:"absolute",top:-7,left:0,right:0,height:6,background:"linear-gradient(90deg, #667eea, #764ba2)"}},children:[e.jsx(t,{sx:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsx(t,{sx:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsxs(t,{position:"relative",zIndex:1,children:[e.jsxs(t,{textAlign:"center",mb:3,children:[e.jsx(t,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:70,height:70,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",mb:2},children:e.jsx(Er,{sx:{fontSize:32}})}),e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Create Account"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Join SecureMyDocs to get started"})]}),e.jsx(ne,{in:!!E,timeout:500,children:e.jsx(t,{children:E&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:E})})}),e.jsx(ne,{in:!!S?.error,timeout:500,children:e.jsx(t,{children:S?.error&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:S.error.message||"Registration failed"})})}),e.jsxs(t,{component:"form",onSubmit:F,sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(B,{fullWidth:!0,label:"First Name",variant:"outlined",value:r,onChange:C=>b(C.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(B,{fullWidth:!0,label:"Last Name",variant:"outlined",value:d,onChange:C=>p(C.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}})]}),e.jsx(B,{fullWidth:!0,label:"Email Address",variant:"outlined",type:"email",value:o,onChange:C=>n(C.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(B,{fullWidth:!0,label:"Password",variant:"outlined",type:h?"text":"password",value:g,onChange:C=>m(C.target.value),required:!0,InputProps:{endAdornment:e.jsx(ge,{position:"end",children:e.jsx(N,{onClick:()=>k(!h),edge:"end",children:h?e.jsx(kt,{}):e.jsx(Xe,{})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(O,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",size:"large",disabled:A||!o||!r||!d||!g,sx:{py:1.8,borderRadius:2,textTransform:"none",fontSize:"1.05rem",fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 6px 16px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 22px rgba(102, 126, 234, 0.5)",transform:"translateY(-2px)",background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"},"&:active":{transform:"translateY(0)"}},children:A?e.jsx(Q,{size:24,sx:{color:"white"}}):"Create Account"})]})]})]}),e.jsx(X,{elevation:8,sx:{mt:2,p:3,borderRadius:3,background:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",textAlign:"center"},children:e.jsxs(l,{variant:"body2",children:["Already have an account?"," ",e.jsx(O,{component:pe,to:"/login",variant:"text",color:"primary",sx:{textTransform:"none",fontWeight:600,fontSize:"inherit",p:0,minWidth:"auto"},children:"Log in"})]})})]})})})}function ns(){const[o,n]=a.useState(""),[r,b]=a.useState(!1),[d,p]=a.useState(""),[g,m]=a.useState(""),h=async k=>{k.preventDefault(),b(!0),m(""),p("");try{(await fe.post(`${ye}auth/forgot-password`,{email:o})).status===200&&p("Password reset link sent to your email. Please check your inbox.")}catch(A){const T=A.response?.data,E=T?.message||T?.error||(typeof T=="string"?T:"Error sending reset link");m(E)}finally{b(!1)}};return e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite","@keyframes gradientShift":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}}},children:e.jsx(je,{in:!0,timeout:800,children:e.jsxs(X,{elevation:24,sx:{width:"100%",maxWidth:440,padding:4,borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)",overflow:"hidden",position:"relative","&::before":{content:'""',position:"absolute",top:-7,left:0,right:0,height:6,background:"linear-gradient(90deg, #667eea, #764ba2)"}},children:[e.jsx(t,{sx:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsx(t,{sx:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsxs(t,{position:"relative",zIndex:1,children:[e.jsxs(t,{textAlign:"center",mb:3,children:[e.jsx(t,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:70,height:70,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",mb:2},children:e.jsx(Ct,{sx:{fontSize:32}})}),e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Reset Password"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Enter your email to receive a reset link"})]}),e.jsx(ne,{in:!!g,timeout:500,children:e.jsx(t,{children:g&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:typeof g=="string"?g:JSON.stringify(g)})})}),e.jsx(ne,{in:!!d,timeout:500,children:e.jsx(t,{children:d&&e.jsx(D,{severity:"success",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(76, 175, 80, 0.1)"},children:d})})}),e.jsxs(t,{component:"form",onSubmit:h,sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(B,{fullWidth:!0,label:"Email Address",variant:"outlined",type:"email",value:o,onChange:k=>n(k.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(O,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",size:"large",disabled:r||!o,sx:{py:1.8,borderRadius:2,textTransform:"none",fontSize:"1.05rem",fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 6px 16px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 22px rgba(102, 126, 234, 0.5)",transform:"translateY(-2px)",background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"},"&:active":{transform:"translateY(0)"}},children:r?e.jsx(Q,{size:24,sx:{color:"white"}}):"Send Reset Link"})]}),e.jsx(t,{sx:{textAlign:"center",mt:3.5},children:e.jsx(O,{component:pe,to:"/login",variant:"text",color:"primary",startIcon:e.jsx(Re,{}),size:"medium",sx:{textTransform:"none",fontWeight:500,color:"#667eea","&:hover":{background:"rgba(102, 126, 234, 0.08)"}},children:"Return to Login"})})]})]})})})}function os(){const[o,n]=a.useState(""),[r,b]=a.useState(""),[d,p]=a.useState(!1),[g,m]=a.useState(""),[h,k]=a.useState(""),[A,T]=a.useState(!1),[E,R]=a.useState(!0),[v]=br(),f=Fe(),S=v.get("token");a.useEffect(()=>{S?F():(k("Invalid reset link"),R(!1))},[S]);const F=async()=>{try{(await fe.post(`${ye}auth/validate-reset-token`,{token:S})).status===200&&T(!0)}catch(c){const j=c.response?.data,y=j?.message||j?.error||(typeof j=="string"?j:"Invalid or expired reset link");k(y)}finally{R(!1)}},C=async c=>{if(c.preventDefault(),p(!0),k(""),m(""),o!==r){k("Passwords do not match"),p(!1);return}if(o.length<6){k("Password must be at least 6 characters long"),p(!1);return}try{(await fe.post(`${ye}auth/reset-password`,{token:S,password:o})).status===200&&(m("Password reset successfully! Redirecting to login..."),setTimeout(()=>{f("/login",{replace:!0})},3e3))}catch(j){const y=j.response?.data,i=y?.message||y?.error||(typeof y=="string"?y:"Error resetting password. Please try again.");k(i)}finally{p(!1)}};return S?e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite","@keyframes gradientShift":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}}},children:e.jsx(je,{in:!0,timeout:800,children:e.jsxs(X,{elevation:24,sx:{width:"100%",maxWidth:440,padding:4,borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)",overflow:"hidden",position:"relative","&::before":{content:'""',position:"absolute",top:-7,left:0,right:0,height:6,background:"linear-gradient(90deg, #667eea, #764ba2)"}},children:[e.jsx(t,{sx:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsx(t,{sx:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",zIndex:0}}),e.jsxs(t,{position:"relative",zIndex:1,children:[e.jsxs(t,{textAlign:"center",mb:3,children:[e.jsx(t,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:70,height:70,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",mb:2},children:e.jsx(me,{sx:{fontSize:32}})}),e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Reset Password"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Create a new password for your account"})]}),e.jsx(ne,{in:!!h,timeout:500,children:e.jsx(t,{children:h&&e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:typeof h=="string"?h:JSON.stringify(h)})})}),e.jsx(ne,{in:!!g,timeout:500,children:e.jsx(t,{children:g&&e.jsx(D,{severity:"success",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(76, 175, 80, 0.1)"},children:g})})}),E?e.jsxs(t,{sx:{textAlign:"center",py:4},children:[e.jsx(Q,{}),e.jsx(l,{variant:"body1",sx:{mt:2},children:"Validating reset link..."})]}):A?e.jsxs(t,{component:"form",onSubmit:C,sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(B,{fullWidth:!0,label:"New Password",variant:"outlined",type:"password",value:o,onChange:c=>n(c.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(B,{fullWidth:!0,label:"Confirm New Password",variant:"outlined",type:"password",value:r,onChange:c=>b(c.target.value),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.2)"},"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(102, 126, 234, 0.5)"}}}}),e.jsx(O,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",size:"large",disabled:d||!o||!r,sx:{py:1.8,borderRadius:2,textTransform:"none",fontSize:"1.05rem",fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 6px 16px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 22px rgba(102, 126, 234, 0.5)",transform:"translateY(-2px)",background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"},"&:active":{transform:"translateY(0)"}},children:d?e.jsx(Q,{size:24,sx:{color:"white"}}):"Reset Password"})]}):e.jsxs(t,{sx:{textAlign:"center",py:2},children:[e.jsx(D,{severity:"warning",sx:{mb:2},children:"This reset link is invalid or has expired."}),e.jsx(O,{component:pe,to:"/forgot-password",variant:"outlined",color:"primary",startIcon:e.jsx(Re,{}),children:"Request New Reset Link"})]}),e.jsx(t,{sx:{textAlign:"center",mt:3.5},children:e.jsx(O,{component:pe,to:"/login",variant:"text",color:"primary",startIcon:e.jsx(Re,{}),size:"medium",sx:{textTransform:"none",fontWeight:500,color:"#667eea","&:hover":{background:"rgba(102, 126, 234, 0.08)"}},children:"Back to Login"})})]})]})})}):e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"400% 400%",animation:"gradientShift 15s ease infinite","@keyframes gradientShift":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}}},children:e.jsx(je,{in:!0,timeout:800,children:e.jsx(X,{elevation:24,sx:{width:"100%",maxWidth:440,padding:4,borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)",overflow:"hidden",position:"relative","&::before":{content:'""',position:"absolute",top:-7,left:0,right:0,height:6,background:"linear-gradient(90deg, #667eea, #764ba2)"}},children:e.jsxs(t,{position:"relative",zIndex:1,children:[e.jsx(D,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 4px 12px rgba(244, 67, 54, 0.1)"},children:"Invalid reset link. Please request a new password reset."}),e.jsx(t,{sx:{textAlign:"center"},children:e.jsx(O,{component:pe,to:"/forgot-password",variant:"outlined",color:"primary",startIcon:e.jsx(Re,{}),sx:{textTransform:"none",fontWeight:500},children:"Request New Reset Link"})})]})})})})}const as=()=>e.jsxs(Ze,{children:[e.jsx(K,{path:"login",element:e.jsx(rs,{})}),e.jsx(K,{path:"register",element:e.jsx(ss,{})}),e.jsx(K,{path:"forgot-password",element:e.jsx(ns,{})}),e.jsx(K,{path:"reset-password",element:e.jsx(os,{})})," ",e.jsx(K,{path:"*",element:e.jsx(qe,{to:"/login",replace:!0})})," "]}),Bt="GET_AUDIT_LOGS_REQUEST",Vt="GET_AUDIT_LOGS_SUCCESS",Ht="GET_AUDIT_LOGS_FAILURE",is="CREATE_AUDIT_LOG_REQUEST",ls="CREATE_AUDIT_LOG_SUCCESS",ds="CREATE_AUDIT_LOG_FAILURE",cs="CLEAR_AUDIT_ERROR",qt=()=>async o=>{o({type:Bt});try{const{data:n}=await M.get("/api/audit-logs/current-user");return o({type:Vt,payload:n}),{success:!0,data:n}}catch(n){const r=n.response?.data?.message||n.message||"Failed to fetch audit logs";return o({type:Ht,payload:r}),{success:!1,error:r}}};class Qt extends a.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(n,r){console.error("Component Error:",n,r)}render(){return this.state.hasError?e.jsxs(t,{p:3,border:1,borderColor:"error.main",borderRadius:2,children:[e.jsx(l,{color:"error",variant:"h6",children:"Something went wrong"}),e.jsx(l,{children:"We're having trouble displaying this content. Please try again later."})]}):this.props.children}}const us=()=>{const o=Se(),{logs:n,loading:r,error:b}=Z(u=>u.audit),{posts:d}=Z(u=>u.post),{auth:p}=Z(u=>u),g=et();Et(g.breakpoints.down("sm"));const[m,h]=a.useState(!1),[k,A]=a.useState(""),[T,E]=a.useState("success"),[R,v]=a.useState(""),[f,S]=a.useState(0),[F,C]=a.useState(10),[c,j]=a.useState({key:"timestamp",direction:"desc"}),[y,i]=a.useState(null),[w,V]=a.useState("all"),[_,H]=a.useState(""),W=u=>u&&(u.fileName||u.documentName||u.imageName||u.videoName)||"N/A",oe=(u,I="list")=>{if(!u||u==="N/A")return"N/A";const z=I==="list"?25:40;return u.length>z?u.slice(0,z)+"...":u},te=(u,I)=>{A(u),E(I),h(!0)};a.useEffect(()=>{ae()},[o]);const ae=()=>{o(qt()).then(u=>{u.success?te("Audit logs loaded successfully","success"):te(u.error,"error")}).catch(u=>{console.error("Failed to fetch audit logs:",u),te("Failed to load audit logs","error")})},Y=a.useMemo(()=>{try{return n||[]}catch(u){return console.error("Error preparing logs:",u),[]}},[n]),J=a.useMemo(()=>Y.map(u=>{const I=W(u);return{...u,fileName:I,displayName:oe(I,"list")}}),[Y]),ie=a.useMemo(()=>{let u=[...J];if(R){const I=R.toLowerCase();u=u.filter(z=>z.user?.email&&z.user.email.toLowerCase().includes(I)||z.action&&z.action.toLowerCase().includes(I)||z.fileName&&z.fileName.toLowerCase().includes(I))}if(w!=="all"&&(u=u.filter(I=>I.action&&I.action===w)),_){const I=new Date(_).toDateString();u=u.filter(z=>z.timestamp&&new Date(z.timestamp).toDateString()===I)}return c.key&&u.sort((I,z)=>{let L,G;return c.key==="fileName"?(L=I.fileName,G=z.fileName):c.key==="userEmail"?(L=I.user?.email||"",G=z.user?.email||""):(L=I[c.key]||"",G=z[c.key]||""),L==null&&(L=""),G==null&&(G=""),L<G?c.direction==="asc"?-1:1:L>G?c.direction==="asc"?1:-1:0}),u},[J,R,c,w,_]),Ce=u=>{j({key:u,direction:c.key===u&&c.direction==="asc"?"desc":"asc"})},ue=(u,I)=>{S(I)},xe=u=>{C(parseInt(u.target.value,10)),S(0)},Ee=a.useMemo(()=>{const u=new Set;return Y.forEach(I=>{I.action&&u.add(I.action)}),Array.from(u)},[Y]),Le=()=>{v(""),V("all"),H(""),j({key:"timestamp",direction:"desc"}),S(0)};return r?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Q,{size:60}),e.jsx(l,{variant:"h6",sx:{mt:2},children:"Loading Audit Logs..."})]})}):b?e.jsx(t,{p:3,children:e.jsx(D,{severity:"error",action:e.jsx(O,{color:"inherit",size:"small",onClick:ae,children:"Retry"}),children:b})}):e.jsxs(t,{sx:{p:{xs:2,sm:3},maxWidth:"100%",overflow:"hidden"},children:[e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,sx:{fontWeight:600,color:"text.primary",mb:{xs:2,sm:0}},children:"Audit Logs"}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(re,{title:"Refresh logs",children:e.jsx(N,{onClick:ae,color:"primary",children:e.jsx(Pr,{})})}),e.jsx(O,{variant:"outlined",startIcon:e.jsx(Tr,{}),onClick:u=>i(u.currentTarget),"data-testid":"filter-button",children:"Filters"})]})]}),e.jsxs(U,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(U,{item:!0,xs:12,sm:6,md:4,children:e.jsx(de,{elevation:2,children:e.jsxs(ce,{children:[e.jsx(l,{color:"textSecondary",gutterBottom:!0,children:"Total Logs"}),e.jsx(l,{variant:"h5",component:"div",children:Y.length})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,md:4,children:e.jsx(de,{elevation:2,children:e.jsxs(ce,{children:[e.jsx(l,{color:"textSecondary",gutterBottom:!0,children:"Filtered Logs"}),e.jsx(l,{variant:"h5",component:"div",children:ie.length})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,md:4,children:e.jsx(de,{elevation:2,children:e.jsxs(ce,{children:[e.jsx(l,{color:"textSecondary",gutterBottom:!0,children:"Unique Actions"}),e.jsx(l,{variant:"h5",component:"div",children:Ee.length})]})})})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsx(B,{placeholder:"Search by action or file name...",value:R,onChange:u=>v(u.target.value),sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(Pt,{})}),endAdornment:R&&e.jsx(ge,{position:"end",children:e.jsx(N,{onClick:()=>v(""),size:"small",children:e.jsx(ct,{})})})}}),(R||w!=="all"||_)&&e.jsx(O,{onClick:Le,startIcon:e.jsx(ct,{}),children:"Clear Filters"})]}),e.jsxs(tt,{anchorEl:y,open:!!y,onClose:()=>i(null),children:[e.jsx(ee,{disabled:!0,children:e.jsx(l,{variant:"subtitle2",children:"Filter by Action"})}),e.jsx(ee,{selected:w==="all",onClick:()=>{V("all"),i(null)},children:"All Actions"}),Ee.map(u=>e.jsx(ee,{selected:w===u,onClick:()=>{V(u),i(null)},children:u},u)),e.jsx(ee,{disabled:!0,sx:{mt:1},children:e.jsx(l,{variant:"subtitle2",children:"Filter by Date"})}),e.jsx(ee,{children:e.jsx(B,{type:"date",value:_,onChange:u=>H(u.target.value),InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(Tt,{fontSize:"small"})})},fullWidth:!0})})]}),e.jsxs(Qt,{children:[e.jsx(Rt,{component:X,elevation:2,sx:{borderRadius:2},children:e.jsxs(At,{children:[e.jsx(It,{children:e.jsxs(Ae,{sx:{backgroundColor:g.palette.grey[50]},children:[e.jsx($,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("strong",{children:"Action"}),e.jsx(N,{size:"small",onClick:()=>Ce("action"),children:e.jsx(Ge,{fontSize:"small",color:c.key==="action"?"primary":"inherit"})})]})}),e.jsx($,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("strong",{children:"File Name"}),e.jsx(N,{size:"small",onClick:()=>Ce("fileName"),children:e.jsx(Ge,{fontSize:"small",color:c.key==="fileName"?"primary":"inherit"})})]})}),e.jsx($,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("strong",{children:"Timestamp"}),e.jsx(N,{size:"small",onClick:()=>Ce("timestamp"),children:e.jsx(Ge,{fontSize:"small",color:c.key==="timestamp"?"primary":"inherit"})})]})})]})}),e.jsx(Ot,{children:ie.length>0?ie.slice(f*F,f*F+F).map((u,I)=>e.jsxs(Ae,{hover:!0,children:[e.jsx($,{children:e.jsx(Ie,{label:u.action||"N/A",size:"small",color:u.action==="UPLOAD"?"primary":u.action==="DELETE"?"error":u.action==="ENABLE_OTP"||u.action==="DISABLE_OTP"?"secondary":"default"})}),e.jsx($,{sx:{maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:u.fileName,children:u.displayName}),e.jsx($,{children:u.timestamp?new Date(u.timestamp).toLocaleString():"-"})]},u.id||I)):e.jsx(Ae,{children:e.jsxs($,{colSpan:3,align:"center",sx:{py:4},children:[e.jsx(l,{variant:"body1",color:"textSecondary",children:"No audit logs found"}),(R||w!=="all"||_)&&e.jsx(O,{onClick:Le,sx:{mt:1},children:"Clear filters"})]})})})]})}),ie.length>0&&e.jsx(Rr,{rowsPerPageOptions:[5,10,25],component:"div",count:ie.length,rowsPerPage:F,page:f,onPageChange:ue,onRowsPerPageChange:xe,sx:{mt:2}})]}),e.jsx(rt,{open:m,autoHideDuration:6e3,onClose:()=>h(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(D,{onClose:()=>h(!1),severity:T,sx:{width:"100%"},children:k})})]})},Yt="CREATE_POST_REQUEST",Jt="CREATE_POST_SUCCESS",Kt="CREATE_POST_FAILURE",Zt="GET_ALL_POST_REQUEST",Xt="GET_ALL_POST_SUCCESS",er="GET_ALL_POST_FAILURE",tr="DELETE_POST_REQUEST",rr="DELETE_POST_SUCCESS",sr="DELETE_POST_FAILURE",xs=o=>async n=>{n({type:Yt});try{const{data:r}=await M.post("/api/posts",o);n({type:Jt,payload:r}),console.log("Post created successfully",r)}catch(r){console.log("Error creating post",r),n({type:Kt,payload:r})}},Ke=()=>async o=>{o({type:Zt});try{const{data:n}=await M.get("/api/posts");return o({type:Xt,payload:n}),{success:!0,data:n}}catch(n){const r=n.response?.data?.message||n.message;return o({type:er,payload:r}),{success:!1,error:r}}},hs=o=>async n=>{n({type:tr});try{return await M.delete(`/api/posts/${o}`),n({type:rr,payload:o}),{success:!0}}catch(r){const b=r.response?.data?.message||r.message;return n({type:sr,payload:b}),{success:!1,error:b}}},ps=({open:o,file:n,onClose:r})=>{const[b,d]=a.useState(!1);if(!n)return null;const p=n.documentName||n.imageName||n.videoName||"Untitled",g=()=>{switch(n.type){case"pdf":return e.jsx(Ye,{sx:{fontSize:40,color:"error.main"}});case"image":return e.jsx(ze,{sx:{fontSize:40,color:"primary.main"}});case"video":return e.jsx(Ar,{sx:{fontSize:40,color:"primary.main"}});case"document":return e.jsx(Oe,{sx:{fontSize:40,color:"primary.main"}});default:return e.jsx(Qe,{sx:{fontSize:40}})}},m=()=>{switch(n.type){case"image":return e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh",overflow:"hidden"},children:e.jsx("img",{src:n.url,alt:p,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})});case"pdf":return e.jsx("iframe",{src:`${n.url}#view=fitH`,width:"100%",height:"70vh",style:{border:"none"},title:"PDF Preview"});case"video":return e.jsx(t,{sx:{display:"flex",justifyContent:"center",height:"70vh",bgcolor:"#000"},children:e.jsxs("video",{controls:!0,autoPlay:!0,style:{maxWidth:"100%",maxHeight:"100%"},children:[e.jsx("source",{src:n.url,type:"video/mp4"}),"Your browser does not support the video tag."]})});default:return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"70vh"},children:[g(),e.jsx(l,{variant:"h6",sx:{mt:2},children:"No preview available"}),e.jsx(l,{color:"text.secondary",children:"This file type cannot be previewed"})]})}};return e.jsxs(e.Fragment,{children:[e.jsxs(st,{open:o,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",maxHeight:"90vh",borderRadius:2,overflow:"hidden"}},children:[e.jsxs(nt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2},children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,children:[g(),e.jsx(l,{noWrap:!0,sx:{maxWidth:400},children:p})]}),e.jsx(re,{title:"Close",children:e.jsx(N,{onClick:r,disabled:b,children:e.jsx(ot,{})})})]}),e.jsx(ke,{}),e.jsx(at,{sx:{p:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:m()})]}),e.jsx(Ue,{open:b,sx:{zIndex:h=>h.zIndex.modal+1,color:"#fff"},children:e.jsx(Q,{color:"inherit"})})]})},gs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2,outline:"none"},nr=({open:o,handleClose:n,onValidate:r,onResend:b,email:d})=>{const[p,g]=a.useState(""),[m,h]=a.useState(!1),[k,A]=a.useState(null),[T,E]=a.useState(null),[R,v]=a.useState(!1);a.useEffect(()=>{o&&!R&&f()},[o]);const f=async()=>{h(!0),A(null);try{await b(),v(!0),E("OTP sent to your email!")}catch(C){A(C.message||"Failed to send OTP")}finally{h(!1)}},S=async C=>{if(C.preventDefault(),!p){A("Please enter OTP");return}h(!0),A(null);try{await r(p),E("OTP verified successfully!"),setTimeout(()=>n(),1e3)}catch(c){A(c.message||"Invalid OTP")}finally{h(!1)}},F=async()=>{h(!0),A(null);try{await b(),E("OTP resent to your email!")}catch(C){A(C.message||"Failed to resend OTP")}finally{h(!1)}};return e.jsx(Ft,{open:o,onClose:m?void 0:n,children:e.jsxs(t,{sx:gs,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Verify OTP"}),T&&e.jsx(D,{severity:"success",sx:{mb:2},children:T}),k&&e.jsx(D,{severity:"error",sx:{mb:2},children:k}),e.jsxs(l,{variant:"body2",sx:{mb:2},children:["OTP sent to: ",d]}),e.jsx(B,{fullWidth:!0,label:"Enter OTP",variant:"outlined",value:p,onChange:C=>g(C.target.value),sx:{mb:2},disabled:m}),e.jsxs(t,{display:"flex",justifyContent:"space-between",children:[e.jsx(O,{variant:"outlined",onClick:F,disabled:m,children:"Resend OTP"}),e.jsx(O,{variant:"contained",onClick:S,disabled:m||!p,children:"Verify"})]}),e.jsx(Ue,{open:m,sx:{zIndex:C=>C.zIndex.drawer+1},children:e.jsx(Q,{color:"inherit"})})]})})},ms=({open:o,onClose:n,file:r})=>{const[b,d]=a.useState(""),[p,g]=a.useState(""),[m,h]=a.useState(""),[k,A]=a.useState(!1),[T,E]=a.useState(""),[R,v]=a.useState(!1),f=()=>r?r.documentName||r.imageName||r.videoName||"Untitled":"Unknown File",S=async()=>{if(!r||!r.id){E("No file selected for sharing");return}A(!0),E("");try{const j=new Date(b);if(isNaN(j.getTime())){E("Please enter a valid date and time"),A(!1);return}const y=j.toISOString(),i=await M.post(`/api/share/create/${r.id}`,null,{params:{expiresAt:y,maxUses:p||null}});i.data.status==="success"&&h(i.data.shareUrl)}catch(j){console.error("Error generating share link:",j),E(j.response?.data?.message||"Failed to generate share link")}finally{A(!1)}},F=()=>{navigator.clipboard.writeText(m),v(!0),setTimeout(()=>v(!1),2e3)},C=()=>{d(""),g(""),h(""),E(""),v(!1)},c=()=>{C(),n()};return e.jsxs(st,{open:o,onClose:c,maxWidth:"sm",fullWidth:!0,children:[e.jsx(nt,{children:e.jsxs(t,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{variant:"h6",children:['Share "',f(),'"']}),e.jsx(N,{onClick:c,size:"small",children:e.jsx(ot,{})})]})}),e.jsx(at,{children:m?e.jsxs(t,{children:[e.jsx(l,{variant:"body2",gutterBottom:!0,children:"Your secure share link has been created:"}),e.jsxs(t,{sx:{p:1.5,mt:1,mb:2,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"grey.50",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(l,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mr:1},children:m}),e.jsx(re,{title:R?"Copied!":"Copy link",children:e.jsx(N,{onClick:F,size:"small",children:e.jsx(Or,{fontSize:"small"})})})]}),e.jsx(D,{severity:"info",icon:!1,sx:{mt:2},children:e.jsxs(l,{variant:"body2",children:[e.jsx("strong",{children:"Note:"})," Recipients will need to request an OTP to access this file if OTP protection is enabled."]})})]}):e.jsxs(t,{children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Create a secure link to share this file. You can set an expiration time and usage limits."}),e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(B,{fullWidth:!0,label:"Expiration Date & Time",type:"datetime-local",value:b,onChange:j=>d(j.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(Tt,{fontSize:"small",color:"action"})})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(B,{fullWidth:!0,label:"Maximum Uses (optional)",type:"number",value:p,onChange:j=>g(j.target.value),placeholder:"Unlimited if empty",InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(Ir,{fontSize:"small",color:"action"})})}})})]}),T&&e.jsx(D,{severity:"error",sx:{mt:2},children:T})]})}),e.jsx(Lt,{children:m?e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:C,children:"Create Another"}),e.jsx(O,{onClick:c,variant:"contained",children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:c,children:"Cancel"}),e.jsx(O,{onClick:S,variant:"contained",disabled:!b||k||!r,children:k?"Creating...":"Create Link"})]})})]})},bs=({files:o=[],onDelete:n,onToggleOtpProtection:r,userEmail:b})=>{const[d,p]=a.useState([]),[g,m]=a.useState(!1),[h,k]=a.useState(null),[A,T]=a.useState(null),[E,R]=a.useState([]),[v,f]=a.useState("list"),[S,F]=a.useState(""),[C,c]=a.useState(!1),[j,y]=a.useState(""),[i,w]=a.useState("success"),[V,_]=a.useState(!1),[H,W]=a.useState(null),[oe,te]=a.useState(!1),[ae,Y]=a.useState(!1),[J,ie]=a.useState(""),[Ce,ue]=a.useState(!1),[xe,Ee]=a.useState(null),[Le,u]=a.useState(!1),[I,z]=a.useState(null),L=(s,x)=>{y(s),w(x),c(!0)},G=o.filter(s=>{const x=S.toLowerCase();return(s.documentName||"").toLowerCase().includes(x)||(s.imageName||"").toLowerCase().includes(x)||(s.videoName||"").toLowerCase().includes(x)}),he=async(s,x="view")=>{try{if(te(!0),(await M.get(`/api/posts/${s.id}/otp-status`)).data.otpProtected){W(s),ie(x),_(!0);try{await M.post(`/api/otp/generate/${s.id}`),L("OTP sent to your email","info")}catch(q){console.error("OTP generation error:",q),L("Failed to send OTP. Please try again.","error")}}else it(s,x)}catch(P){L("Error checking file access","error"),console.error("OTP check error:",P)}finally{te(!1)}},or=async(s,x)=>{try{if((await M.post(`/api/secure/posts/${s}/generate-otp-toggle`)).status===200){const q=o.find(Pe=>Pe.id===s);W(q),ie(x?"enable_otp":"disable_otp"),_(!0),L("OTP sent to your email for verification","info")}}catch(P){console.error("Failed to generate OTP for toggle:",P),L("Failed to initiate OTP protection change","error")}},it=(s,x)=>{switch(x){case"view":lr(s);break;case"download":ur(s);break;case"delete":Ee(s),ue(!0);break}},ar=async s=>{try{if(Y(!0),J==="enable_otp"||J==="disable_otp"){const x=J==="enable_otp";if((await M.post(`/api/secure/posts/${H.id}/toggle-otp?enable=${x}`,{otpCode:s})).status===200)return L(`OTP protection ${x?"enabled":"disabled"} successfully`,"success"),window.location.reload(),_(!1),!0}else{const x=await M.post(`/api/otp/validate/${H.id}`,{code:s});if(x.data.valid||x.data.status==="success")return L("OTP verified successfully","success"),_(!1),J==="delete"?(Ee(H),ue(!0)):it(H,J),!0;{const q=x.data.message||"Invalid OTP";return L(q,"error"),!1}}}catch(x){const P=x.response?.data?.message||(J.includes("otp")?"Failed to update OTP protection":"Invalid OTP");throw L(P,"error"),new Error(P)}finally{Y(!1)}},ir=async()=>{try{if(Y(!0),J==="enable_otp"||J==="disable_otp"){if((await M.post(`/api/secure/posts/${H.id}/generate-otp-toggle`)).status===200)return L("OTP resent to your email","success"),!0}else{const s=await M.post(`/api/otp/generate/${H.id}`);if(s.status===200)return L("OTP resent to your email","success"),!0;s.status===429&&L("Please wait before requesting another OTP","warning")}return!1}catch(s){const x=s.response?.data?.message||"Failed to resend OTP";throw L(x,"error"),new Error(x)}finally{Y(!1)}},lt=s=>{const x=d.indexOf(s);let P=[];x===-1?P=[...d,s]:P=d.filter(q=>q!==s),p(P)},lr=s=>{k({...s,type:s.image?"image":s.document?.endsWith(".pdf")?"pdf":s.video?"video":"file",url:s.image||s.document||s.video,name:s.documentName||s.imageName||s.videoName||s.document?.split("/").pop()||s.image?.split("/").pop()||s.video?.split("/").pop()||"Untitled",owner:s.user?.firstName||"You",modified:s.createdAt||new Date().toISOString()}),m(!0)},dr=(s,x)=>{s.stopPropagation(),T(s.currentTarget),k(x)},ve=()=>{T(null)},cr=(s,x)=>{x.stopPropagation(),R(P=>P.includes(s)?P.filter(q=>q!==s):[...P,s])},ur=async s=>{try{Y(!0);const x=s.image||s.document||s.video,P=s.documentName||s.imageName||s.videoName||"download";let q=x;const Pe=x.includes("cloudinary.com"),We=s.document&&!s.image&&!s.video;Pe&&We&&(q=x.replace("/upload/","/upload/fl_attachment/"));const we=await fetch(q);if(!we.ok)throw new Error(`Failed to fetch file: ${we.status} ${we.statusText}`);const Me=await we.blob(),_e=window.URL.createObjectURL(Me),Te=document.createElement("a");Te.href=_e,Te.download=P,document.body.appendChild(Te),Te.click(),window.URL.revokeObjectURL(_e),document.body.removeChild(Te),L("File downloaded successfully","success")}catch(x){console.error("Download error:",x),L("Failed to download file","error")}finally{Y(!1)}},xr=()=>{d.length!==0&&window.confirm(`Are you sure you want to delete ${d.length} selected files?`)&&(d.forEach(s=>{n(s)}),p([]),L(`${d.length} files deleted successfully`,"success"))},hr=(s,x="medium")=>{const P={fontSize:x};return s.image?e.jsx(ze,{color:"primary",...P}):s.document?s.document.endsWith(".pdf")?e.jsx(Ye,{color:"error",...P}):e.jsx(Oe,{color:"primary",...P}):s.video?e.jsx(gt,{color:"primary",...P}):e.jsx(Qe,{...P})},pr=(s,x=80)=>{const P=E.includes(s.id)?e.jsx(pt,{color:"warning",fontSize:"small"}):null;return s.image?e.jsx(Ne,{badgeContent:P,anchorOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(be,{variant:"rounded",src:s.image,sx:{width:x,height:x}})}):s.video?e.jsx(Ne,{badgeContent:P,anchorOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(t,{sx:{width:x,height:x,position:"relative",bgcolor:"grey.200",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(gt,{sx:{fontSize:x/2,color:"grey.600"}})})}):s.document?.endsWith(".pdf")?e.jsx(Ne,{badgeContent:P,anchorOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(be,{variant:"rounded",sx:{width:x,height:x,bgcolor:"error.light",color:"error.contrastText"},children:e.jsx(Ye,{sx:{fontSize:x/2}})})}):e.jsx(Ne,{badgeContent:P,anchorOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(be,{variant:"rounded",sx:{width:x,height:x,bgcolor:"grey.300",color:"grey.600"},children:e.jsx(Qe,{sx:{fontSize:x/2}})})})},gr=s=>{if(!s)return"Unknown date";const x=new Date(s);if(isNaN(x.getTime()))return"Invalid date";const P=x.getDate().toString().padStart(2,"0"),Pe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][x.getMonth()],We=x.getFullYear(),we=x.getHours().toString().padStart(2,"0"),Me=x.getMinutes().toString().padStart(2,"0"),_e=x.getSeconds().toString().padStart(2,"0");return`${P} ${Pe} ${We} ${we}:${Me}:${_e}`},dt=(s,x)=>{if(!s)return"Untitled";const P=x==="grid"?10:25;return s.length>P?`${s.substring(0,P)}...`:s},mr=s=>{z(s),u(!0)};return e.jsxs(t,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",p:1,borderBottom:"1px solid",borderColor:"divider",gap:1},children:[e.jsx($e,{indeterminate:d.length>0&&d.length<G.length,checked:d.length===G.length&&G.length>0,onChange:()=>{p(d.length===G.length?[]:G.map(s=>s.id))}}),d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"body2",sx:{mr:1},children:[d.length," selected"]}),e.jsx(re,{title:"Download",children:e.jsx(N,{onClick:()=>{if(d.length===1){const s=o.find(x=>x.id===d[0]);he(s,"download")}else L("Multiple download not supported","warning")},children:e.jsx(ut,{fontSize:"small"})})}),e.jsx(re,{title:"Share",children:e.jsx(N,{children:e.jsx(xt,{fontSize:"small"})})}),e.jsx(re,{title:"Delete",children:e.jsx(N,{onClick:()=>{if(d.length===1){const s=o.find(x=>x.id===d[0]);he(s,"delete")}else xr()},children:e.jsx(ht,{fontSize:"small"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),e.jsx(re,{title:"List view",children:e.jsx(N,{onClick:()=>f("list"),color:v==="list"?"primary":"default",children:e.jsx(Fr,{fontSize:"small"})})}),e.jsx(re,{title:"Grid view",children:e.jsx(N,{onClick:()=>f("grid"),color:v==="grid"?"primary":"default",children:e.jsx(Lr,{fontSize:"small"})})})]}),e.jsx(t,{sx:{flexGrow:1}}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",bgcolor:"action.hover",borderRadius:1,px:1,py:.5,width:300},children:[e.jsx(Pt,{fontSize:"small",sx:{color:"text.secondary",mr:1}}),e.jsx(_r,{placeholder:"Search in Drive",value:S,onChange:s=>F(s.target.value),sx:{width:"100%"}})]})]}),e.jsx(t,{sx:{flexGrow:1,overflow:"auto"},children:v==="list"?e.jsx(Rt,{component:X,elevation:0,children:e.jsxs(At,{sx:{minWidth:650},size:"small",children:[e.jsx(It,{children:e.jsxs(Ae,{children:[e.jsx($,{padding:"checkbox"}),e.jsx($,{sx:{width:"70%"},children:"Name"}),e.jsx($,{children:"Created At"}),e.jsx($,{padding:"checkbox"})]})}),e.jsx(Ot,{children:G.map(s=>e.jsxs(Ae,{hover:!0,selected:d.includes(s.id),onDoubleClick:()=>he(s,"view"),sx:{cursor:"pointer","& .MuiTableCell-root":{py:1.4}},children:[e.jsx($,{padding:"checkbox",children:e.jsx($e,{checked:d.includes(s.id),onChange:()=>lt(s.id),onClick:x=>x.stopPropagation()})}),e.jsx($,{children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1.5,children:[e.jsx(re,{title:E.includes(s.id)?"Remove star":"Add star",children:e.jsx(N,{onClick:x=>cr(s.id,x),size:"small",children:E.includes(s.id)?e.jsx(pt,{color:"warning"}):e.jsx(Nr,{})})}),s.otpProtected&&e.jsx(me,{fontSize:"small",color:"primary"}),hr(s,"small"),e.jsx(l,{variant:"body2",children:dt(s.documentName||s.imageName||s.videoName,"list")})]})}),e.jsx($,{children:e.jsx(l,{variant:"body2",children:gr(s.createdAt)})}),e.jsx($,{padding:"checkbox",children:e.jsx(N,{size:"small",onClick:x=>dr(x,s),children:e.jsx(Je,{fontSize:"small"})})})]},s.id))})]})}):e.jsx(U,{container:!0,spacing:2,p:2,children:G.map(s=>e.jsx(U,{item:!0,xs:6,sm:4,md:3,lg:2,children:e.jsxs(t,{onDoubleClick:()=>he(s,"view"),sx:{p:1,border:"1px solid",borderColor:d.includes(s.id)?"primary.main":"divider",borderRadius:1,cursor:"pointer",bgcolor:d.includes(s.id)?"action.selected":"background.paper","&:hover":{bgcolor:"action.hover"},position:"relative"},children:[e.jsx($e,{checked:d.includes(s.id),onChange:()=>lt(s.id),sx:{position:"absolute",p:.5},size:"small"}),s.otpProtected&&e.jsx(me,{fontSize:"small",color:"primary",sx:{position:"absolute",top:4,right:4}}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[pr(s),e.jsx(l,{variant:"body2",sx:{mt:1,textAlign:"center",wordBreak:"break-word",width:"100%"},children:dt(s.documentName||s.imageName||s.videoName,"grid")})]})]})},s.id))})}),e.jsxs(tt,{anchorEl:A,open:!!A,onClose:ve,onClick:s=>s.stopPropagation(),children:[e.jsxs(ee,{onClick:()=>{ve(),h&&he(h,"view")},children:[e.jsx(se,{children:e.jsx(Oe,{fontSize:"small"})}),e.jsx(le,{children:"Open"})]}),e.jsxs(ee,{onClick:()=>{ve(),or(h.id,!h.otpProtected)},children:[e.jsx(se,{children:h?.otpProtected?e.jsx(Dr,{fontSize:"small"}):e.jsx(me,{fontSize:"small"})}),e.jsx(le,{children:h?.otpProtected?"Disable OTP":"Enable OTP"})]}),e.jsxs(ee,{onClick:()=>{ve(),h&&he(h,"download")},children:[e.jsx(se,{children:e.jsx(ut,{fontSize:"small"})}),e.jsx(le,{children:"Download"})]}),e.jsxs(ee,{onClick:()=>{ve(),h&&mr(h)},children:[e.jsx(se,{children:e.jsx(xt,{fontSize:"small"})}),e.jsx(le,{children:"Share"})]}),e.jsxs(ee,{onClick:()=>{ve(),h&&he(h,"delete")},children:[e.jsx(se,{children:e.jsx(ht,{fontSize:"small",color:"error"})}),e.jsx(le,{sx:{color:"error.main"},children:"Delete"})]})]}),e.jsx(ps,{open:g,file:h,onClose:()=>m(!1)}),e.jsx(nr,{open:V,handleClose:()=>!ae&&_(!1),onValidate:ar,onResend:ir,email:b,actionType:J}),e.jsx(ms,{open:Le,onClose:()=>u(!1),file:I}),e.jsxs(st,{open:Ce,onClose:()=>ue(!1),children:[e.jsx(nt,{children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(zr,{color:"warning"}),"Confirm Delete"]})}),e.jsxs(at,{children:[e.jsxs(l,{children:['Are you sure you want to delete "',xe?.documentName||xe?.imageName||xe?.videoName,'"?']}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This action cannot be undone."})]}),e.jsxs(Lt,{children:[e.jsx(O,{onClick:()=>ue(!1),children:"Cancel"}),e.jsx(O,{onClick:()=>{xe&&(n(xe.id),ue(!1))},color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(rt,{open:C,autoHideDuration:6e3,onClose:()=>c(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(D,{onClose:()=>c(!1),severity:i,sx:{width:"100%"},children:j})}),e.jsx(Ue,{open:oe,sx:{zIndex:s=>s.zIndex.modal+1},children:e.jsx(Q,{color:"inherit"})})]})},fs=()=>{const o=Se(),{posts:n,loading:r,error:b}=Z(f=>f.post),{auth:d}=Z(f=>f),[p,g]=a.useState(!1),[m,h]=a.useState(""),[k,A]=a.useState("success"),T=(f,S)=>{h(f),A(S),g(!0)};a.useEffect(()=>{o(Ke())},[o]);const E=async f=>{try{await o(hs(f)),T("File deleted successfully","success")}catch(S){T(S.message||"Failed to delete file","error")}},R=async(f,S)=>{try{(await M.patch(`/api/posts/${f}/otp-protection?enabled=${S}`,{},{headers:{"Content-Type":"application/json"}})).status===200&&(o(Ke()),T(`OTP protection ${S?"enabled":"disabled"} successfully`,"success"))}catch(F){console.error("Failed to update OTP protection:",F)}},v=fr.useMemo(()=>{try{return n?.filter(f=>f?.document||f?.image||f?.video)||[]}catch(f){return console.error("Error filtering posts:",f),[]}},[n]);return r?e.jsx(t,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Q,{size:60})}):b?e.jsx(t,{p:3,children:e.jsx(D,{severity:"error",children:b})}):e.jsxs(t,{sx:{p:3,maxWidth:"100%",overflow:"hidden"},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,sx:{mb:3,fontWeight:600,color:"text.primary"},children:"My Documents"}),e.jsx(Qt,{children:e.jsx(bs,{files:v,onDelete:E,onToggleOtpProtection:R,userEmail:d.user?.email})}),e.jsx(rt,{open:p,autoHideDuration:6e3,onClose:()=>g(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(D,{onClose:()=>g(!1),severity:k,sx:{width:"100%"},children:m})})]})},vt="dzxhzpc1h",js="xzalCloud",ys=async(o,n)=>{if(!o||!n)throw console.error("Missing required parameters"),new Error("Both file and fileType are required");try{const r=new FormData;r.append("file",o),r.append("upload_preset",js),r.append("cloud_name",vt),r.append("folder",n);let b="auto";n==="image"?b="image":n==="video"?b="video":n==="docs"&&(b="raw");const d=await fetch(`https://api.cloudinary.com/v1_1/${vt}/${b}/upload`,{method:"POST",body:r});if(!d.ok){const g=await d.json();throw new Error(g.message||"Upload failed")}const p=await d.json();return console.log("Cloudinary response:",p),p.secure_url||p.url}catch(r){throw console.error("Cloudinary upload error:",r),r}},Ss={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"90vw",sm:500},maxHeight:"90vh",bgcolor:"background.paper",boxShadow:24,p:3,borderRadius:2,outline:"none",overflowY:"auto"},vs=({open:o,handleClose:n})=>{const[r,b]=a.useState(null),[d,p]=a.useState(null),[g,m]=a.useState(null),[h,k]=a.useState(!1),[A,T]=a.useState(0),[E,R]=a.useState(null),v=Se(),{auth:f}=Z(j=>j),S=async j=>{const y=j.target.files[0];if(!y)return;const i={docs:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","application/zip","application/x-rar-compressed"]},w=y.type.startsWith("image")?"image":y.type.startsWith("video")?"video":i.docs.includes(y.type)?"docs":null;if(!w){R("Invalid file type. Please upload image, video, or document.");return}const V=w==="image"?10:w==="video"?100:20;if(y.size>V*1024*1024){R(`${w} size must be less than ${V}MB`);return}R(null),k(!0);try{const _=await ys(y,w);w==="image"?(b(_),c.setFieldValue("image",_),c.setFieldValue("imageName",y.name),p(null),m(null),c.setFieldValue("video",""),c.setFieldValue("videoName",""),c.setFieldValue("document",""),c.setFieldValue("documentName","")):w==="video"?(p(_),c.setFieldValue("video",_),c.setFieldValue("videoName",y.name),b(null),m(null),c.setFieldValue("image",""),c.setFieldValue("imageName",""),c.setFieldValue("document",""),c.setFieldValue("documentName","")):(m({url:_,name:y.name,type:y.type}),c.setFieldValue("document",_),c.setFieldValue("documentName",y.name),b(null),p(null),c.setFieldValue("image",""),c.setFieldValue("imageName",""),c.setFieldValue("video",""),c.setFieldValue("videoName",""))}catch(_){R(_.message||"Upload failed")}finally{k(!1),T(0)}},F=j=>{j==="image"?(b(null),c.setFieldValue("image",""),c.setFieldValue("imageName","")):j==="video"?(p(null),c.setFieldValue("video",""),c.setFieldValue("videoName","")):(m(null),c.setFieldValue("document",""),c.setFieldValue("documentName",""))},C=j=>j.includes("word")?"":j.includes("pdf")?"":j.includes("powerpoint")||j.includes("presentation")?"":j.includes("excel")||j.includes("spreadsheet")?"":j.includes("zip")||j.includes("rar")?"":"",c=wr({initialValues:{captions:"",image:"",imageName:"",video:"",videoName:"",document:"",documentName:""},onSubmit:(j,{resetForm:y})=>{if(!j.captions&&!j.image&&!j.video&&!j.document){R("Please add a caption or media");return}v(xs(j)),y(),b(null),p(null),m(null),n()}});return e.jsx(Ft,{open:o,onClose:h?void 0:n,"aria-labelledby":"create-post-modal",children:e.jsxs(t,{sx:Ss,children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(l,{variant:"h6",children:"Create Post"}),e.jsx(N,{onClick:n,disabled:h,sx:{visibility:h?"hidden":"visible"},children:e.jsx(ot,{})})]}),e.jsxs("form",{onSubmit:c.handleSubmit,children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,mb:3,children:[e.jsx(be,{src:f.user?.profilePicture,sx:{width:48,height:48}}),e.jsxs(t,{children:[e.jsxs(l,{fontWeight:"bold",children:[f.user?.firstName," ",f.user?.lastName]}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["@",f.user?.firstName?.toLowerCase(),"_",f.user?.lastName?.toLowerCase()]})]})]}),e.jsx(B,{fullWidth:!0,multiline:!0,rows:4,placeholder:"What's on your mind?",name:"captions",value:c.values.captions,onChange:c.handleChange,sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:2,p:1}}}),E&&e.jsx(l,{color:"error",mb:2,children:E}),e.jsxs(t,{display:"flex",gap:2,mb:3,children:[e.jsx("input",{type:"file",accept:"image/*,video/*,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt,.zip,.rar",onChange:S,style:{display:"none"},id:"file-input",disabled:h}),e.jsx("label",{htmlFor:"file-input",children:e.jsx(N,{color:"primary",component:"span",disabled:h,children:e.jsx(Ur,{})})}),e.jsx(l,{variant:"caption",children:"Upload Media or Document"})]}),r&&e.jsxs(t,{position:"relative",mb:3,children:[e.jsx("img",{src:r,alt:"Selected",style:{width:"100%",maxHeight:300,objectFit:"contain",borderRadius:8}}),e.jsx(Ie,{label:"Remove",onClick:()=>F("image"),color:"error",size:"small",sx:{position:"absolute",top:8,right:8}})]}),d&&e.jsxs(t,{position:"relative",mb:3,children:[e.jsx("video",{controls:!0,src:d,style:{width:"100%",maxHeight:300,borderRadius:8}}),e.jsx(Ie,{label:"Remove",onClick:()=>F("video"),color:"error",size:"small",sx:{position:"absolute",top:8,right:8}})]}),g&&e.jsxs(t,{position:"relative",mb:3,p:2,border:1,borderRadius:2,borderColor:"grey.300",children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(l,{variant:"h5",children:C(g.type)}),e.jsxs(t,{children:[e.jsx(l,{variant:"body2",noWrap:!0,sx:{maxWidth:300},children:g.name}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"Document"})]})]}),e.jsx(Ie,{label:"Remove",onClick:()=>F("document"),color:"error",size:"small",sx:{position:"absolute",top:8,right:8}})]}),e.jsx(t,{display:"flex",justifyContent:"flex-end",children:e.jsx(O,{variant:"contained",type:"submit",disabled:h||!c.values.captions&&!r&&!d&&!g,sx:{borderRadius:6,px:3},children:"Post"})})]}),e.jsx(Ue,{sx:{color:"#fff",zIndex:j=>j.zIndex.drawer+1,backgroundColor:"rgba(0,0,0,0.8)"},open:h,children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Q,{color:"inherit"}),e.jsx(l,{mt:2,children:"Uploading file..."})]})})]})})},ws=()=>{const o=et();return Et(o.breakpoints.down("md")),e.jsx(t,{component:"footer",sx:{background:"linear-gradient(135deg, #2c3e50 0%, #3498db 100%)",color:"white",py:6,mt:"auto",ml:4,width:"100%",position:"relative",left:0,right:0,borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(Wr,{maxWidth:!1,sx:{width:"100%",px:{xs:2,sm:3},marginLeft:{md:"280px"}},children:[e.jsx(U,{container:!0,spacing:4,justifyContent:"center",children:e.jsxs(U,{item:!0,xs:12,md:8,children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:{xs:"column",md:"row"},mb:3,gap:{xs:2,md:3}},children:[e.jsx(t,{component:"img",src:"/secureMyDocs_logo.png",alt:"secureMyDocs Logo",sx:{height:100,width:"auto",display:{xs:"none",md:"block"},filter:"brightness(0) invert(1)"}}),e.jsx(l,{variant:"body2",sx:{opacity:.9,lineHeight:1.6,textAlign:{xs:"center",md:"left"},fontSize:"0.9rem",maxWidth:"600px"},children:"Enterprise-grade document security solution providing cutting-edge protection for sensitive files with OTP-based authentication and comprehensive audit trails."})]}),e.jsx(t,{sx:{mt:3,display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"wrap",gap:1},children:[{icon:e.jsx(Mr,{}),href:"https://www.linkedin.com/in/santu-kumar-72239231b/",label:"LinkedIn",text:"LinkedIn"},{icon:e.jsx(Gr,{}),href:"https://github.com/Santu-kumar364",label:"GitHub",text:"GitHub"},{icon:e.jsx(t,{component:"img",src:"https://img.icons8.com/?size=100&id=wDGo581Ea5Nf&format=png&color=000000",sx:{height:24,width:24,filter:"brightness(0) invert(1)"},alt:"LeetCode"}),href:"https://leetcode.com/u/santukumar7619/",label:"LeetCode",text:"LeetCode"},{icon:e.jsx($r,{}),href:"https://my-portfolio-chi-rose-78.vercel.app/",label:"Portfolio",text:"Portfolio"}].map((n,r)=>e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",m:1},children:[e.jsx(N,{component:"a",href:n.href,target:"_blank",rel:"noopener noreferrer","aria-label":n.label,sx:{width:42,height:42,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)",transform:"translateY(-2px)"},transition:"all 0.2s ease"},children:n.icon}),e.jsx(l,{variant:"caption",sx:{mt:1,opacity:.9,fontSize:"0.75rem",display:"block"},children:n.text})]},r))})]})}),e.jsx(ke,{sx:{my:4,backgroundColor:"rgba(255,255,255,0.2)"}}),e.jsx(t,{sx:{textAlign:"center"},children:e.jsxs(l,{variant:"body2",sx:{opacity:.8,fontSize:"0.85rem",letterSpacing:"0.5px"},children:[" ",new Date().getFullYear()," secureMyDocs. All rights reserved. | Enterprise document security solutions"]})})]})})},ks=()=>{const o=Se(),n=Fe(),r=et(),[b,d]=a.useState(!1),[p,g]=a.useState(!1),[m,h]=a.useState(null),{posts:k,loading:A,error:T}=Z(i=>i.post),{logs:E,loading:R,error:v}=Z(i=>i.audit),{auth:f}=Z(i=>i);a.useEffect(()=>{o(Ke()),o(qt())},[o]);const S=a.useMemo(()=>{try{return k?.filter(i=>i?.document||i?.image||i?.video)||[]}catch(i){return console.error("Error filtering posts:",i),[]}},[k]),F=i=>i.document&&i.documentName?i.documentName:i.image&&i.imageName?i.imageName:i.video&&i.videoName?i.videoName:"Untitled",C=i=>{if(!i)return"Unknown date";const w=new Date(i);if(isNaN(w.getTime()))return"Invalid date";const V=w.getDate().toString().padStart(2,"0"),H=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][w.getMonth()],W=w.getFullYear(),oe=w.getHours().toString().padStart(2,"0"),te=w.getMinutes().toString().padStart(2,"0"),ae=w.getSeconds().toString().padStart(2,"0");return`${V} ${H} ${W} ${oe}:${te}:${ae}`},c=a.useMemo(()=>{const i=S.filter(W=>W.document).length,w=S.filter(W=>W.image).length,V=S.filter(W=>W.video).length,_=S.filter(W=>W.otpProtected).length,H=[...S].sort((W,oe)=>{const te=W.createdAt?new Date(W.createdAt):new Date(0);return(oe.createdAt?new Date(oe.createdAt):new Date(0))-te});return{total:S.length,documents:i,images:w,videos:V,otpProtected:_,recentUploads:H.slice(0,4)}},[S]),j=i=>i.document?e.jsx(Oe,{color:"primary"}):i.image?e.jsx(ze,{color:"secondary"}):i.video?e.jsx(Qr,{color:"error"}):e.jsx(He,{color:"disabled"}),y=()=>{o(ts()),h(null)};return A||R?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(Q,{size:60})}):T||v?e.jsx(t,{p:3,children:e.jsx(D,{severity:"error",children:T||v||"Failed to load dashboard data"})}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f8fafc"},children:[e.jsx(Br,{position:"fixed",sx:{display:{xs:"flex",md:"none"},backgroundColor:"white",color:"text.primary",boxShadow:"0 1px 3px rgba(0,0,0,0.12)"},children:e.jsxs(Vr,{children:[e.jsx(N,{edge:"start",sx:{mr:2},onClick:()=>g(!0),children:e.jsx(Hr,{})}),e.jsx(l,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,color:"primary.main"},children:"secureMyDocs"}),e.jsx(N,{onClick:i=>h(i.currentTarget),sx:{p:0},children:e.jsx(be,{sx:{width:32,height:32,bgcolor:"primary.main"},children:f.user?.firstName?.charAt(0)})})]})}),e.jsx(mt,{variant:"permanent",sx:{display:{xs:"none",md:"block"},width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",borderRight:`1px solid ${r.palette.divider}`}},open:!0,children:e.jsxs(t,{sx:{p:2,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,color:"primary.main",mb:3,textAlign:"center"},children:"secureMyDocs"}),e.jsx(Be,{sx:{flexGrow:1},children:[{text:"Dashboard",icon:e.jsx(bt,{}),path:"/",action:null},{text:"My Documents",icon:e.jsx(ft,{}),path:"/documents",action:null},{text:"Upload",icon:e.jsx(jt,{}),path:null,action:()=>d(!0)},{text:"Audit Logs",icon:e.jsx(yt,{}),path:"/audit-logs",action:null}].map(i=>e.jsx(Ve,{disablePadding:!0,sx:{mb:1},children:e.jsxs(St,{selected:window.location.pathname===i.path,onClick:()=>{i.action?i.action():i.path&&n(i.path)},sx:{borderRadius:2,"&.Mui-selected":{bgcolor:De(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:De(r.palette.primary.main,.2)}}},children:[e.jsx(se,{sx:{color:window.location.pathname===i.path?"primary.main":"inherit",minWidth:40},children:i.icon}),e.jsx(le,{primary:i.text})]})},i.text))}),e.jsx(t,{sx:{p:2,borderTop:`1px solid ${r.palette.divider}`},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(be,{sx:{width:40,height:40,bgcolor:"primary.main",mr:2},children:f.user?.firstName?.charAt(0)}),e.jsxs(t,{sx:{flexGrow:1},children:[e.jsxs(l,{variant:"body1",sx:{fontWeight:500},children:[f.user?.firstName," ",f.user?.lastName]}),e.jsx(l,{variant:"body2",color:"textSecondary",sx:{maxWidth:"20ch",wordBreak:"break-word",overflowWrap:"break-word"},children:f.user?.email})]}),e.jsx(N,{size:"small",onClick:i=>h(i.currentTarget),children:e.jsx(Je,{fontSize:"small"})})]})})]})}),e.jsxs(t,{component:"main",sx:{flexGrow:1,p:3,mt:{xs:-1,md:-9,lg:-3}},children:[e.jsxs(t,{sx:{mb:4},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,sx:{fontWeight:700,color:"text.primary"},children:"Dashboard"}),e.jsxs(l,{variant:"body1",color:"text.secondary",children:["Welcome back,"," ",e.jsx(l,{component:"span",sx:{fontWeight:600,color:"primary.main"},children:f.user?.firstName+" "+f.user?.lastName||"User"}),"! Here's what's happening with your documents today."]})]}),e.jsx(t,{sx:{display:{xs:"block",md:"block"},mb:4},children:e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{elevation:2,sx:{height:"100%",borderRadius:2,borderLeft:`4px solid ${r.palette.primary.main}`},children:e.jsxs(ce,{sx:{textAlign:"center",p:2},children:[e.jsx(He,{sx:{fontSize:30,color:"primary.main",mb:1}}),e.jsx(l,{variant:"h4",component:"div",gutterBottom:!0,children:c.total}),e.jsx(l,{variant:"body2",color:"textSecondary",children:"Total Files"})]})})}),e.jsx(U,{item:!0,xs:12,sm:"6",md:3,children:e.jsx(de,{elevation:2,sx:{height:"100%",borderRadius:2,borderLeft:`4px solid ${r.palette.info.main}`},children:e.jsxs(ce,{sx:{textAlign:"center",p:2},children:[e.jsx(Oe,{sx:{fontSize:30,color:"info.main",mb:1}}),e.jsx(l,{variant:"h4",component:"div",gutterBottom:!0,children:c.documents}),e.jsx(l,{variant:"body2",color:"textSecondary",children:"Documents"})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{elevation:2,sx:{height:"100%",borderRadius:2,borderLeft:`4px solid ${r.palette.secondary.main}`},children:e.jsxs(ce,{sx:{textAlign:"center",p:2},children:[e.jsx(ze,{sx:{fontSize:30,color:"secondary.main",mb:1}}),e.jsx(l,{variant:"h4",component:"div",gutterBottom:!0,children:c.images+c.videos}),e.jsx(l,{variant:"body2",color:"textSecondary",children:"Media Files"})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{elevation:2,sx:{height:"100%",borderRadius:2,borderLeft:`4px solid ${r.palette.warning.main}`},children:e.jsxs(ce,{sx:{textAlign:"center",p:2},children:[e.jsx(me,{sx:{fontSize:30,color:"warning.main",mb:1}}),e.jsx(l,{variant:"h4",component:"div",gutterBottom:!0,children:c.otpProtected}),e.jsx(l,{variant:"body2",color:"textSecondary",children:"OTP Protected"})]})})})]})}),e.jsx(U,{container:!0,spacing:3,sx:{mb:2},children:e.jsx(U,{item:!0,xs:12,children:e.jsxs(X,{elevation:2,sx:{p:3,borderRadius:2,height:"97%"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:"Recent Uploads"}),e.jsx(ke,{}),c.recentUploads.length>0?e.jsx(Be,{sx:{py:0},children:c.recentUploads.map((i,w)=>{const V=F(i);return e.jsxs(t,{children:[e.jsxs(Ve,{sx:{py:1.5,px:0},children:[e.jsx(se,{sx:{minWidth:40},children:j(i)}),e.jsx(le,{primary:e.jsx(l,{sx:{fontWeight:500,fontSize:"0.95rem"},children:V}),secondary:`Uploaded on ${C(i.createdAt)}`}),i.otpProtected&&e.jsx(Ie,{size:"small",icon:e.jsx(me,{}),label:"OTP",color:"warning",variant:"outlined",sx:{ml:1}})]}),w<c.recentUploads.length-1&&e.jsx(ke,{})]},w)})}):e.jsxs(t,{sx:{textAlign:"center",py:4},children:[e.jsx(He,{sx:{fontSize:40,color:"text.disabled",mb:1}}),e.jsx(l,{variant:"body2",color:"textSecondary",children:"No files uploaded yet"})]})]})})}),b&&e.jsx(vs,{open:b,handleClose:()=>d(!1)})]}),e.jsx(mt,{variant:"temporary",open:p,onClose:()=>g(!1),ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:280}},children:e.jsxs(t,{sx:{p:2,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,color:"primary.main",mb:3,textAlign:"center"},children:"secureMyDocs"}),e.jsx(Be,{sx:{flexGrow:1},children:[{text:"Dashboard",icon:e.jsx(bt,{}),path:"/",action:null},{text:"My Documents",icon:e.jsx(ft,{}),path:"/documents",action:null},{text:"Upload",icon:e.jsx(jt,{}),path:null,action:()=>{d(!0),g(!1)}},{text:"Audit Logs",icon:e.jsx(yt,{}),path:"/audit-logs",action:null}].map(i=>e.jsx(Ve,{disablePadding:!0,sx:{mb:1},children:e.jsxs(St,{selected:window.location.pathname===i.path,onClick:()=>{i.action?i.action():i.path&&(n(i.path),g(!1))},sx:{borderRadius:2,"&.Mui-selected":{bgcolor:De(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:De(r.palette.primary.main,.2)}}},children:[e.jsx(se,{sx:{color:window.location.pathname===i.path?"primary.main":"inherit",minWidth:40},children:i.icon}),e.jsx(le,{primary:i.text})]})},i.text))}),e.jsx(t,{sx:{p:2,borderTop:`1px solid ${r.palette.divider}`},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1,ml:-2,mr:-3},children:[e.jsx(be,{sx:{width:40,height:40,bgcolor:"primary.main",mr:1.5},children:f.user?.firstName?.charAt(0)}),e.jsxs(t,{sx:{flexGrow:1},children:[e.jsxs(l,{variant:"body1",sx:{fontWeight:500},children:[f.user?.firstName," ",f.user?.lastName]}),e.jsx(l,{variant:"body2",color:"textSecondary",sx:{maxWidth:"20ch",wordBreak:"break-word",overflowWrap:"break-word"},children:f.user?.email})]}),e.jsx(N,{size:"small",onClick:i=>{h(i.currentTarget),g(!1)},children:e.jsx(Je,{fontSize:"small"})})]})})]})}),e.jsx(tt,{anchorEl:m,open:!!m,onClose:()=>h(null),PaperProps:{elevation:3,sx:{mt:1.5,minWidth:180}},children:e.jsxs(ee,{onClick:y,children:[e.jsx(se,{children:e.jsx(qr,{fontSize:"small"})}),"Logout"]})})]}),e.jsx(ws,{})]})},Cs=240,Es=()=>e.jsx(t,{sx:{display:"flex"},children:e.jsx(t,{component:"main",sx:{flexGrow:1,px:{xs:2,sm:3,md:4},mt:{xs:8,lg:2},width:{lg:`calc(100% - ${Cs}px)`}},children:e.jsxs(Ze,{children:[e.jsx(K,{path:"/",element:e.jsx(qe,{to:"/dashboard",replace:!0})}),e.jsx(K,{path:"/dashboard",element:e.jsx(ks,{})}),e.jsx(K,{path:"/documents",element:e.jsx(fs,{})}),e.jsx(K,{path:"/audit-logs",element:e.jsx(us,{})}),e.jsx(K,{path:"*",element:e.jsx(qe,{to:"/dashboard",replace:!0})})]})})}),Ps=()=>{const{token:o}=jr(),n=Fe(),[r,b]=a.useState(null),[d,p]=a.useState(!0),[g,m]=a.useState(""),[h,k]=a.useState(!1),[A,T]=a.useState(!1),[E,R]=a.useState(null),[v,f]=a.useState(null);a.useEffect(()=>{S()},[o]);const S=async(y=null)=>{try{p(!0),m("");const i=y?{otp:y}:{},w=await M.get(`/api/public/shared/${o}`,{params:i});w.data.status==="success"?(b(w.data.post),T(w.data.post.otpProtected&&!y),(!w.data.post.otpProtected||y)&&await F(y)):w.data.status==="otp_required"&&(T(!0),R(w.data.fileId),m("This file is protected. Please provide an OTP."))}catch(i){console.error("Full error details:",i.response?.data||i),i.response?.status===400?i.response.data?.status==="otp_required"?(T(!0),R(i.response.data.fileId),m("This file is protected. Please provide an OTP.")):m(i.response.data?.message||"Invalid request"):i.response?.status===404?m("This share link is invalid or has expired."):i.response?.status===401?m("Invalid OTP. Please try again."):i.response?.status===500?m("Server error. Please try again later."):m("Failed to access the shared file. Please try again.")}finally{p(!1)}},F=async(y=null)=>{try{const i=y?{otp:y}:{},w=await M.get(`/api/public/shared/${o}/view`,{params:i});w.data.status==="success"&&f(w.data.fileUrl)}catch(i){console.error("Error fetching file URL:",i),m("Failed to load file for viewing.")}},C=async()=>{try{m(""),(await M.post(`/api/public/shared/${o}/request-otp`)).data.status==="success"&&(k(!0),m("OTP has been sent to the file owner's email."))}catch(y){console.error("OTP request error:",y.response?.data||y),m(y.response?.data?.message||"Failed to request OTP. Please try again.")}},c=async y=>{try{return m(""),await S(y),k(!1),!0}catch(i){throw new Error(i.response?.data?.message||"Invalid OTP")}},j=()=>{if(!v)return null;const y=r?.documentName?.split(".").pop()?.toLowerCase()||r?.imageName?.split(".").pop()?.toLowerCase()||r?.videoName?.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(y)?e.jsx(t,{sx:{mt:3,textAlign:"center"},children:e.jsx(t,{sx:{p:2,border:"2px dashed",borderColor:"primary.main",borderRadius:3,backgroundColor:"rgba(102, 126, 234, 0.05)"},children:e.jsx("img",{src:v,alt:r.documentName||r.imageName||r.videoName,style:{maxWidth:"100%",maxHeight:"400px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.15)",border:"3px solid white"}})})}):["pdf"].includes(y)?e.jsx(t,{sx:{mt:3,height:"500px",borderRadius:3,overflow:"hidden"},children:e.jsx("iframe",{src:v,title:r.documentName||r.imageName||r.videoName,width:"100%",height:"100%",style:{border:"none",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.12)"}})}):["mp4","webm","ogg"].includes(y)?e.jsx(t,{sx:{mt:3,textAlign:"center"},children:e.jsx(t,{sx:{p:2,border:"2px dashed",borderColor:"secondary.main",borderRadius:3,backgroundColor:"rgba(118, 75, 162, 0.05)"},children:e.jsxs("video",{controls:!0,style:{maxWidth:"100%",maxHeight:"400px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.15)",border:"3px solid white"},children:[e.jsx("source",{src:v,type:`video/${y}`}),"Your browser does not support the video tag."]})})}):e.jsx(de,{sx:{mt:3,backgroundColor:"grey.50",border:"none"},children:e.jsx(ce,{sx:{textAlign:"center",py:4},children:e.jsx(O,{variant:"contained",onClick:()=>window.open(v,"_blank"),sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:2,px:3,py:1},children:"Open File"})})})};return d?e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:2},children:e.jsx(je,{in:!0,children:e.jsxs(X,{sx:{p:6,textAlign:"center",background:"rgba(255, 255, 255, 0.98)",borderRadius:4,boxShadow:"0 20px 40px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsx(Q,{size:60,thickness:4,sx:{color:"primary.main",mb:3}}),e.jsx(l,{variant:"h6",sx:{color:"text.primary",fontWeight:600},children:"Loading Shared File"}),e.jsx(l,{variant:"body2",sx:{color:"text.secondary",mt:1},children:"Please wait while we prepare your content..."})]})})}):e.jsxs(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundAttachment:"fixed"},children:[e.jsx(je,{in:!0,children:e.jsxs(X,{sx:{width:"100%",maxWidth:900,p:5,background:"rgba(255, 255, 255, 0.98)",borderRadius:4,boxShadow:"0 25px 50px rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.3)",backdropFilter:"blur(10px)"},children:[e.jsx(ne,{in:!!g,children:e.jsx(t,{sx:{mb:4},children:g&&e.jsx(D,{severity:g.includes("OTP has been sent")?"success":"error",sx:{borderRadius:3,alignItems:"center",fontSize:"0.95rem"},children:g})})}),r?e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{textAlign:"center",mb:4},children:[e.jsx(t,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",mb:3,boxShadow:"0 8px 24px rgba(102, 126, 234, 0.3)"},children:e.jsx(Yr,{sx:{fontSize:40,color:"white"}})}),e.jsx(l,{variant:"h3",sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:800,mb:1},children:"Secure File Access"})]}),r.otpProtected?e.jsxs(t,{sx:{textAlign:"center",mb:4},children:[e.jsx(D,{severity:"info",sx:{mb:3,borderRadius:3,background:"linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%)"},icon:e.jsx(me,{sx:{fontSize:24}}),children:e.jsx(l,{variant:"body1",fontWeight:600,children:"Enhanced Security Enabled"})}),e.jsx(O,{variant:"contained",onClick:C,startIcon:e.jsx(Ct,{}),size:"large",sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:3,px:4,py:1.5,fontSize:"1.1rem",fontWeight:600,boxShadow:"0 8px 24px rgba(102, 126, 234, 0.3)","&:hover":{background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)",boxShadow:"0 12px 32px rgba(102, 126, 234, 0.4)"}},children:"Request Access Code"})]}):e.jsxs(t,{children:[e.jsx(D,{severity:"success",sx:{mb:3,borderRadius:3,background:"linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%)"},icon:e.jsx(Xe,{sx:{fontSize:24}}),children:e.jsx(l,{variant:"body1",fontWeight:600,children:"Ready to View"})}),v&&j()]})]}):e.jsxs(t,{sx:{textAlign:"center",py:4},children:[e.jsx(l,{variant:"h4",color:"error",gutterBottom:!0,children:" Link Expired"}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This share link is no longer valid or has expired."})]}),e.jsx(t,{sx:{textAlign:"center",mt:4},children:e.jsx(O,{onClick:()=>n(-1),variant:"outlined",startIcon:e.jsx(Re,{}),sx:{borderRadius:3,px:3,py:1,borderWidth:2,"&:hover":{borderWidth:2}},children:"Return to Previous Page"})})]})}),e.jsx(nr,{open:h,handleClose:()=>k(!1),onValidate:c,onResend:C,email:"recipient@example.com",actionType:"access"})]})};function Ts(){const o=Z(p=>p.auth),n=Se(),r=localStorage.getItem("jwt"),[b,d]=a.useState(!1);return a.useEffect(()=>{r&&!o.user&&!b&&(d(!0),n(es(r)).catch(p=>{console.error("Failed to get profile:",p),localStorage.removeItem("jwt")}))},[n,r,o.user,b]),r&&!o.user&&!o.error?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{children:"Loading..."})}):e.jsxs(Ze,{children:[e.jsx(K,{path:"/shared/:token",element:e.jsx(Ps,{})}),e.jsx(K,{path:"/*",element:o.user?e.jsx(Es,{}):e.jsx(as,{})})]})}const wt={jwt:localStorage.getItem("jwt"),error:null,loading:!1,user:null,searchUser:[],isAuthenticated:!1,lastAction:null},Rs=(o=wt,n)=>{switch(n.type){case _t:case zt:case Mt:return{...o,loading:!0,error:null,lastAction:n.type};case Gt:return{...o,user:n.payload,loading:!1,error:null};case Nt:case Ut:return console.log(" Auth success, token received"),{...o,jwt:n.payload,isAuthenticated:!0,loading:!1,error:null,lastAction:n.type};case Dt:case Wt:case $t:return{...o,loading:!1,error:n.payload,isAuthenticated:!1,lastAction:n.type};case Kr:return localStorage.removeItem("jwt"),{...wt,jwt:null,isAuthenticated:!1,lastAction:n.type};default:return o}},As={posts:[],currentPost:null,loading:!1,error:null,comments:[],newComment:[]},Is=(o=As,n)=>{switch(n.type){case Yt:case Zt:case tr:return{...o,loading:!0,error:null};case Jt:return{...o,loading:!1,error:null,currentPost:n.payload,posts:[n.payload,...o.posts]};case Xt:return{...o,loading:!1,error:null,posts:n.payload,comments:n.payload.flatMap(r=>r.comments||[])};case rr:return{...o,loading:!1,error:null,posts:o.posts.filter(r=>r.id!==n.payload)};case Kt:case er:case sr:return{...o,loading:!1,error:n.payload};default:return o}},Os={logs:[],loading:!1,error:null,creating:!1,createError:null},Fs=(o=Os,n)=>{switch(n.type){case Bt:return{...o,loading:!0,error:null};case Vt:return{...o,loading:!1,logs:n.payload,error:null};case Ht:return{...o,loading:!1,error:n.payload,logs:[]};case is:return{...o,creating:!0,createError:null};case ls:return{...o,creating:!1,logs:[n.payload,...o.logs],createError:null};case ds:return{...o,creating:!1,createError:n.payload};case cs:return{...o,error:null,createError:null};default:return o}},Ls=kr({reducer:{auth:Rs,post:Is,audit:Fs}});yr.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Sr,{store:Ls,children:e.jsx(vr,{children:e.jsx(Ts,{})})})}));
